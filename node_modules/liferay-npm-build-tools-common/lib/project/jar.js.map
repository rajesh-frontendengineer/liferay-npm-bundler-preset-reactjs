{"version":3,"sources":["../../src/project/jar.js"],"names":["Jar","project","_project","_customManifestHeaders","undefined","_outputDir","_outputFilename","_webContextPath","_npmbundlerrc","manifestFilePath","featuresHeaders","npmbundlerrcHeaders","prop","get","Object","assign","outputDirPosixPath","supported","buildDir","asPosix","startsWith","FilePath","posix","_pkgJson","name","version"],"mappings":"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","file":"jar.js","sourcesContent":["/**\n * Â© 2017 Liferay, Inc. <https://liferay.com>\n *\n * SPDX-License-Identifier: LGPL-3.0-or-later\n */\n\nimport prop from 'dot-prop';\nimport readJsonSync from 'read-json-sync';\n\nimport FilePath from '../file-path';\nimport {getFeaturesFilePath} from './util';\n\n/**\n * Reflects JAR file configuration of JS Toolkit projects.\n */\nexport default class Jar {\n\t/**\n\t *\n\t * @param {Project} project\n\t */\n\tconstructor(project) {\n\t\tthis._project = project;\n\n\t\tthis._customManifestHeaders = undefined;\n\t\tthis._outputDir = undefined;\n\t\tthis._outputFilename = undefined;\n\t\tthis._webContextPath = undefined;\n\t}\n\n\t/**\n\t * Get user configured manifest headers\n\t */\n\tget customManifestHeaders() {\n\t\tconst {_npmbundlerrc} = this._project;\n\n\t\tif (this._customManifestHeaders === undefined) {\n\t\t\tconst manifestFilePath = getFeaturesFilePath(\n\t\t\t\tthis._project,\n\t\t\t\t'create-jar.features.manifest',\n\t\t\t\t'features/manifest.json'\n\t\t\t);\n\n\t\t\tconst featuresHeaders = manifestFilePath\n\t\t\t\t? readJsonSync(manifestFilePath)\n\t\t\t\t: {};\n\n\t\t\tconst npmbundlerrcHeaders = prop.get(\n\t\t\t\t_npmbundlerrc,\n\t\t\t\t'create-jar.customManifestHeaders',\n\t\t\t\t{}\n\t\t\t);\n\n\t\t\tthis._customManifestHeaders = Object.assign(\n\t\t\t\tnpmbundlerrcHeaders,\n\t\t\t\tfeaturesHeaders\n\t\t\t);\n\t\t}\n\n\t\treturn this._customManifestHeaders;\n\t}\n\n\t/**\n\t * Get output directory for JAR file relative to `project.dir` and\n\t * starting with `./`\n\t * @return {FilePath}\n\t */\n\tget outputDir() {\n\t\tconst {_project} = this;\n\t\tconst {_npmbundlerrc} = _project;\n\n\t\tif (this._outputDir === undefined) {\n\t\t\tlet outputDirPosixPath = prop.get(\n\t\t\t\t_npmbundlerrc,\n\t\t\t\t'create-jar.output-dir',\n\t\t\t\tthis.supported ? _project.buildDir.asPosix : undefined\n\t\t\t);\n\n\t\t\tif (outputDirPosixPath !== undefined) {\n\t\t\t\tif (!outputDirPosixPath.startsWith('./')) {\n\t\t\t\t\toutputDirPosixPath = `./${outputDirPosixPath}`;\n\t\t\t\t}\n\n\t\t\t\tthis._outputDir = new FilePath(outputDirPosixPath, {\n\t\t\t\t\tposix: true,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn this._outputDir;\n\t}\n\n\t/**\n\t * Get filename of output JAR file\n\t */\n\tget outputFilename() {\n\t\tconst {_npmbundlerrc, _pkgJson} = this._project;\n\n\t\tif (this._outputFilename === undefined) {\n\t\t\tthis._outputFilename = prop.get(\n\t\t\t\t_npmbundlerrc,\n\t\t\t\t'create-jar.output-filename',\n\t\t\t\tthis.supported\n\t\t\t\t\t? _pkgJson.name + '-' + _pkgJson.version + '.jar'\n\t\t\t\t\t: undefined\n\t\t\t);\n\t\t}\n\n\t\treturn this._outputFilename;\n\t}\n\n\t/**\n\t * @return {boolean}\n\t */\n\tget supported() {\n\t\tconst {_npmbundlerrc} = this._project;\n\n\t\treturn !!prop.get(_npmbundlerrc, 'create-jar', false);\n\t}\n\n\tget webContextPath() {\n\t\tconst {_npmbundlerrc, _pkgJson} = this._project;\n\n\t\tif (!this._webContextPath) {\n\t\t\tthis._webContextPath = prop.get(\n\t\t\t\t_npmbundlerrc,\n\t\t\t\t'create-jar.features.web-context',\n\t\t\t\t// TODO: deprecated 'web-context-path', remove for the next major version\n\t\t\t\tprop.get(\n\t\t\t\t\t_npmbundlerrc,\n\t\t\t\t\t'create-jar.web-context-path',\n\t\t\t\t\t// TODO: deprecated 'osgi.Web-ContextPath', remove for the next major version\n\t\t\t\t\tprop.get(\n\t\t\t\t\t\t_pkgJson,\n\t\t\t\t\t\t'osgi.Web-ContextPath',\n\t\t\t\t\t\t`/${_pkgJson.name}-${_pkgJson.version}`\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\treturn this._webContextPath;\n\t}\n}\n"]}
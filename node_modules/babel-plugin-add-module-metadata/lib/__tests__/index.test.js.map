{"version":3,"sources":["../../src/__tests__/index.test.js"],"names":["babel","babelIpc","pkgJson","require","path","join","__dirname","pkgDesc","PkgDesc","name","version","logger","manifest","beforeEach","set","__filename","log","PluginLogger","Manifest","rootPkgJson","describe","case1Source","case2Source","it","source","transform","filenameRelative","plugins","plugin","pkg","getPackage","flags","modules","expect","esModule","toBe","messages","toMatchSnapshot"],"mappings":";;AAMA;;IAAYA,K;;AACZ;;IAAYC,Q;;AACZ;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;;;;;AAEA,IAAMC,UAAUC,QAAQC,eAAKC,IAAL,CAAUC,SAAV,EAAqB,oBAArB,CAAR,CAAhB,C,CAfA;;;;;;AAgBA,IAAMC,UAAU,IAAIC,iBAAJ,CAAYN,QAAQO,IAApB,EAA0BP,QAAQQ,OAAlC,EAA2C,IAA3C,CAAhB;;AAEA,IAAIC,eAAJ;AAAA,IAAYC,iBAAZ;;AAEAC,WAAW,YAAM;AAChBZ,UAASa,GAAT,CAAaC,UAAb,EAAyB;AACxBC,OAAML,SAAS,IAAIM,sBAAJ,EADS;AAExBL,YAAWA,WAAW,IAAIM,kBAAJ,EAFE;AAGxBC,eAAajB;AAHW,EAAzB;AAKA,CAND;;AAQAkB,SAAS,eAAT,EAA0B,YAAM;AAC/B,KAAMC,qMAAN;AASA,KAAMC,qMAAN;;AAUAC,IAAG,oBAAH,EAAyB,YAAM;AAC9B,MAAMC,SAASH,WAAf;;AAEArB,QAAMyB,SAAN,CAAgBD,MAAhB,EAAwB;AACvBE,qBAAkBX,UADK;AAEvBY,YAAS,CAACC,eAAD;AAFc,GAAxB;;AAKA,MAAMC,MAAMjB,SAASkB,UAAT,CAAoBvB,OAApB,CAAZ;;AAR8B,MAUvBwB,KAVuB,GAUdF,IAAIG,OAAJ,CAAY,6BAAZ,CAVc,CAUvBD,KAVuB;;;AAY9BE,SAAOF,MAAMG,QAAb,EAAuBC,IAAvB,CAA4B,IAA5B;AACA,EAbD;;AAeAZ,IAAG,oBAAH,EAAyB,YAAM;AAC9B,MAAMC,mKAAN;;AAQAxB,QAAMyB,SAAN,CAAgBD,MAAhB,EAAwB;AACvBE,qBAAkBX,UADK;AAEvBY,YAAS,CAACC,eAAD;AAFc,GAAxB;;AAKA,MAAMC,MAAMjB,SAASkB,UAAT,CAAoBvB,OAApB,CAAZ;;AAd8B,MAgBvBwB,KAhBuB,GAgBdF,IAAIG,OAAJ,CAAY,6BAAZ,CAhBc,CAgBvBD,KAhBuB;;;AAkB9BE,SAAOF,MAAMG,QAAb,EAAuBC,IAAvB,CAA4B,IAA5B;AACA,EAnBD;;AAqBAZ,IAAG,kCAAH,EAAuC,YAAM;AAC5C,MAAMC,SAASH,WAAf;;AAEArB,QAAMyB,SAAN,CAAgBD,MAAhB,EAAwB;AACvBE,qBAAkBX,UADK;AAEvBY,YAAS,CAACC,eAAD;AAFc,GAAxB;;AAKAK,SAAOtB,OAAOyB,QAAd,EAAwBC,eAAxB;AACA,EATD;;AAWAd,IAAG,kCAAH,EAAuC,YAAM;AAC5C,MAAMC,SAASF,WAAf;;AAEAtB,QAAMyB,SAAN,CAAgBD,MAAhB,EAAwB;AACvBE,qBAAkBX,UADK;AAEvBY,YAAS,CAACC,eAAD;AAFc,GAAxB;;AAKAK,SAAOtB,OAAOyB,QAAd,EAAwBC,eAAxB;AACA,EATD;AAUA,CA7ED","file":"index.test.js","sourcesContent":["/**\n * Â© 2017 Liferay, Inc. <https://liferay.com>\n *\n * SPDX-License-Identifier: LGPL-3.0-or-later\n */\n\nimport * as babel from 'babel-core';\nimport * as babelIpc from 'liferay-npm-build-tools-common/lib/babel-ipc';\nimport Manifest from 'liferay-npm-build-tools-common/lib/manifest';\nimport PluginLogger from 'liferay-npm-build-tools-common/lib/plugin-logger';\nimport PkgDesc from 'liferay-npm-build-tools-common/lib/pkg-desc';\nimport path from 'path';\n\nimport plugin from '../index';\n\nconst pkgJson = require(path.join(__dirname, '../../package.json'));\nconst pkgDesc = new PkgDesc(pkgJson.name, pkgJson.version, null);\n\nlet logger, manifest;\n\nbeforeEach(() => {\n\tbabelIpc.set(__filename, {\n\t\tlog: (logger = new PluginLogger()),\n\t\tmanifest: (manifest = new Manifest()),\n\t\trootPkgJson: pkgJson,\n\t});\n});\n\ndescribe('esModule flag', () => {\n\tconst case1Source = `\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t  });\n\n\tvar x = require('./x');\n\tconsole.log('x is', x);\n\tmodule.exports = 'Here is x: ' + x;\n\t`;\n\tconst case2Source = `\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t  });\n\n\tvar x = require('./x');\n\tconsole.log('x is', x);\n\tmodule.exports = 'Here is x: ' + x;\n\t`;\n\n\tit('is added in case 1', () => {\n\t\tconst source = case1Source;\n\n\t\tbabel.transform(source, {\n\t\t\tfilenameRelative: __filename,\n\t\t\tplugins: [plugin],\n\t\t});\n\n\t\tconst pkg = manifest.getPackage(pkgDesc);\n\n\t\tconst {flags} = pkg.modules['src/__tests__/index.test.js'];\n\n\t\texpect(flags.esModule).toBe(true);\n\t});\n\n\tit('is added in case 2', () => {\n\t\tconst source = `\n\t\tmodule.exports.__esModule = true;\n\n\t\tvar x = require('./x');\n\t\tconsole.log('x is', x);\n\t\tmodule.exports = 'Here is x: ' + x;\n\t\t`;\n\n\t\tbabel.transform(source, {\n\t\t\tfilenameRelative: __filename,\n\t\t\tplugins: [plugin],\n\t\t});\n\n\t\tconst pkg = manifest.getPackage(pkgDesc);\n\n\t\tconst {flags} = pkg.modules['src/__tests__/index.test.js'];\n\n\t\texpect(flags.esModule).toBe(true);\n\t});\n\n\tit('logs results correctly in case 1', () => {\n\t\tconst source = case1Source;\n\n\t\tbabel.transform(source, {\n\t\t\tfilenameRelative: __filename,\n\t\t\tplugins: [plugin],\n\t\t});\n\n\t\texpect(logger.messages).toMatchSnapshot();\n\t});\n\n\tit('logs results correctly in case 2', () => {\n\t\tconst source = case2Source;\n\n\t\tbabel.transform(source, {\n\t\t\tfilenameRelative: __filename,\n\t\t\tplugins: [plugin],\n\t\t});\n\n\t\texpect(logger.messages).toMatchSnapshot();\n\t});\n});\n"]}